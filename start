#!/bin/bash

# Common
source "${0%/*}/config"
if [[ -z "$room" ]]; then
 log "Cannot start!  Run sudo ./setup to configure"
 exit 1
fi


# Make sure all the necessary paths exists
[ -d "$pathLog" ] || mkdir -p "$pathLog"
[ -d "$pathVideo" ] || mkdir -p "$pathVideo"


# Make sure everything is stopped..
$pathRoot/stop

# Clear out the preview image (or create it so VLC will serve it up)
echo > $pathRoot/preview.jpg


# Start VLC
logVLC=$pathRoot/log/vlc.log


cvlc -vvvvvv --intf=http  --http-port=8888  --http-src="$pathRoot"  --vlm-conf="$pathRoot/config-media"  >> "$logVLC" 2>&1  &
#     --scene-format=jpg --scene-path="$pathRoot"  --scene-prefix=preview --scene-width=320 --scene-height=180 --scene-replace \

log "VLC Launched (logging to $logVLC)"

# Sleep for a bit, then set the camera options
sleep 5
$pathRoot/quality

# Notify that we're running
$pathRoot/notify "Capture Started"
