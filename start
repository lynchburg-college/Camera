#!/bin/bash

# Common
source "${0%/*}/config"
if [[ -z "$room" ]]; then
 log "Cannot start!  Run sudo ./setup to configure"
 exit 1
fi


# Make sure all the necessary paths exists
[ -d "$pathLog" ] || mkdir -p "$pathLog"
[ -d "$pathVideo" ] || mkdir -p "$pathVideo"


# Make sure everything is stopped..
$pathRoot/stop

#logVLC=$pathRoot/log/vlc.log
logVLC=/dev/null

# Start the camera
cvlc --quiet 'v4l2:///dev/video0:chroma=H264:width=1024:height=576:fps=30' --sout '#standard{access=http,mux=ts,dst=:8990/camera}' >> "$logVLC" 2>&1 &
log "Camera Launched (logging to $logVLC)"

# Start the HTTP interface
cvlc --quiet --intf=http  --http-port=8888  --http-src="$pathRoot"  --vlm-conf="$pathRoot/config-media"  >> "$logVLC" 2>&1  &
log "Recorder Launched (logging to $logVLC)"

# Sleep for a bit, then set the camera options
sleep 5
$pathRoot/quality

# Notify that we're running
$pathRoot/notify "Capture Started"
